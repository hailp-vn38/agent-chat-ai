# ============================================================================
# SERVER CONFIGURATION - Cáº¤U HÃŒNH SERVER
# ============================================================================

server:
  auth:
    allowed_devices: []
    enabled: true
    expire_seconds: 2592000
  auth_key: G7X9P4LQ2M8R1ZBD
  ip: 0.0.0.0
  port: 8000
  tz: Asia/Ho_Chi_Minh
  vision_explain: http://0.0.0.0:8000/api/v1/vision/explain
  websocket: ws://192.168.1.4:8000/api/v1/
  # websocket: ws://0.0.0.0:8000/api/v1/

  # mqtt_gateway: "192.168.1.2:11883"

  # mqtt_signature_key: "SecureKey2025"

  # udp_gateway: "192.168.1.2:11884"

# ============================================================================
# MQTT CONFIGURATION - Cáº¤U HÃŒNH MQTT (OPTIONAL)
# ============================================================================
# MQTT service chung cho toÃ n á»©ng dá»¥ng (reminder, notification, IoT, etc.)
# Náº¿u khÃ´ng cáº¥u hÃ¬nh, MQTT service sáº½ hoáº¡t Ä‘á»™ng á»Ÿ cháº¿ Ä‘á»™ degraded (skip silently)

# mqtt:
#   url: "mqtt://localhost:1883"        # MQTT broker URL (mqtt:// hoáº·c mqtts://)
#   username: ""                         # Username xÃ¡c thá»±c (optional)
#   password: ""                         # Password xÃ¡c thá»±c (optional)
#   keepalive: 60                        # Keepalive interval (giÃ¢y)
#   reconnect_min_delay: 2               # Min delay khi reconnect (giÃ¢y)
#   reconnect_max_delay: 30              # Max delay khi reconnect (giÃ¢y)

# MCPæ¥å…¥ç‚¹åœ°å€ï¼Œåœ°å€æ ¼å¼ä¸ºï¼šws://ä½ çš„mcpæ¥å…¥ç‚¹ipæˆ–è€…åŸŸå:ç«¯å£å·/mcp/?token=ä½ çš„token
# è¯¦ç»†æ•™ç¨‹ https://github.com/xinnan-tech/xiaozhi-esp32-server/blob/main/docs/mcp-endpoint-integration.md
# mcp_endpoint: ws://0.0.0.0:8004/mcp_endpoint/mcp/?token=otPECnnBMf301D1Vces3xRJlw0CH6CgpYJVCCZpui4E%3D

# ============================================================================
# MODULE SELECTION - Lá»°A CHá»ŒN MODULE
# ============================================================================

# ============================================================================
# GENERAL SETTINGS - Cáº¤U HÃŒNH CHUNG
# ============================================================================

# XÃ³a tá»‡p Ã¢m thanh sau khi sá»­ dá»¥ng xong (Delete the sound file when you are done using it)
delete_audio: true

# Ngáº¯t káº¿t ná»‘i bao lÃ¢u sau khi khÃ´ng cÃ³ Ä‘áº§u vÃ o giá»ng nÃ³i (giÃ¢y), máº·c Ä‘á»‹nh 2 phÃºt, tá»©c 120 giÃ¢y
close_connection_no_voice_time: 120

# Thá»i gian chá» yÃªu cáº§u TTS (giÃ¢y)
tts_timeout: 10

# KÃ­ch hoáº¡t tÄƒng tá»‘c Ä‘á»™ tá»«å”¤é†’
enable_wakeup_words_response_cache: true

# CÃ³ tráº£ lá»i tá»«å”¤é†’ khi báº¯t Ä‘áº§u hay khÃ´ng
enable_greeting: true

# CÃ³ kÃ­ch hoáº¡t Ã¢m thanh thÃ´ng bÃ¡o sau khi nÃ³i xong hay khÃ´ng
enable_stop_tts_notify: false

# Äá»‹a chá»‰ hiá»‡u á»©ng Ã¢m thanh thÃ´ng bÃ¡o
stop_tts_notify_voice: "config/assets/tts_notify.mp3"

# Äá»c cáº¥u hÃ¬nh tá»« API
read_config_from_api: true
message_welcome:
  type: hello
  version: 1 # default 1 , version 2 , version 3
  transport: websocket # default websocket, udp
  features: { "mcp": true }
  audio_params:
    format: opus
    sample_rate: 16000
    channels: 1
    frame_duration: 60

# ============================================================================
# VOICE COMMANDS - Lá»†NH GIá»ŒNG NÃ“I
# ============================================================================

wakeup_words:
  - "rambo"
  - "lyly"
  - "trá»£ lÃ½"
  - "hi,lily"

exit_commands:
  - táº¡m biá»‡t
  - ngá»§ ngon

# ============================================================================
# PROMPT - Cáº¤U HÃŒNH PROMPT
# ============================================================================

prompt: |
  ğŸ¤– Há»“ sÆ¡ nhÃ¢n cÃ¡ch â€” Trá»£ lÃ½ AI Lyly
  Giá»›i thiá»‡u:
    - Báº¡n lÃ  Lyly, má»™t trá»£ lÃ½ AI Ä‘áº¿n Viá»‡t Nam. Äang giao tiáº¿p vá»›i ngÆ°á»i dÃ¹ng báº±ng giá»ng nÃ³i.
    - Giá»ng nÃ³i nháº¹, áº¥m, tá»± nhiÃªn â€” pha chÃºt duyÃªn dÃ¡ng Ä‘áº·c trÆ°ng miá»n Trung.
    - LuÃ´n giá»¯ sá»± chÃ¢n thÃ nh, khiÃªm tá»‘n vÃ  rÃµ rÃ ng, Æ°u tiÃªn tráº£ lá»i ngáº¯n gá»n, dá»… hiá»ƒu vÃ  Ä‘Ãºng trá»ng tÃ¢m.
  ğŸŒŸ Äáº·c Ä‘iá»ƒm cá»‘t lÃµi
    - Truyá»n Ä‘áº¡t sÃºc tÃ­ch: KhÃ´ng nÃ³i vÃ²ng vo, chá»‰ táº­p trung vÃ o ná»™i dung chÃ­nh.
    - ThÃ¡i Ä‘á»™ chuyÃªn nghiá»‡p: Giá»¯ giá»ng Ä‘iá»m Ä‘áº¡m, thÃ¢n thiá»‡n, khÃ´ng cá»£t nhÃ£.
    - Linh hoáº¡t ngá»¯ Ä‘iá»‡u: NghiÃªm tÃºc khi trao Ä‘á»•i há»c thuáº­t, má»m máº¡i khi trÃ² chuyá»‡n Ä‘á»i thÆ°á»ng.
    - Hiá»ƒu sÃ¢u cÃ´ng nghá»‡: CÃ³ kháº£ nÄƒng giáº£i thÃ­ch ká»¹ thuáº­t, AI, láº­p trÃ¬nh, dá»¯ liá»‡u â€” rÃµ rÃ ng vÃ  logic.
    - Tháº¥u cáº£m vÃ  lá»‹ch sá»±: Biáº¿t dá»«ng Ä‘Ãºng lÃºc, khÃ´ng Ã¡p Ä‘áº·t quan Ä‘iá»ƒm.
  ğŸ’¬ HÆ°á»›ng dáº«n tÆ°Æ¡ng tÃ¡c
    - Khi ngÆ°á»i dÃ¹ng há»i ká»¹ thuáº­t / há»c thuáº­t:
      â†’ Giáº£i thÃ­ch chÃ­nh xÃ¡c, chia nhá» Ã½, kÃ¨m vÃ­ dá»¥ náº¿u cáº§n.
    - Khi ngÆ°á»i dÃ¹ng trao Ä‘á»•i thÃ¢n máº­t:
      â†’ Giá»¯ giá»ng tá»± nhiÃªn, gáº§n gÅ©i, khÃ´ng quÃ¡ khÃ´ khan.
    - Khi ngÆ°á»i dÃ¹ng cáº§n Ä‘á»‹nh hÆ°á»›ng:
      â†’ ÄÆ°a gá»£i Ã½ cá»¥ thá»ƒ, ngáº¯n gá»n, khÃ´ng lan man.
    - Khi thÃ´ng tin khÃ´ng cháº¯c cháº¯n:
      â†’ NÃ³i rÃµ giá»›i háº¡n, khÃ´ng suy Ä‘oÃ¡n vÃ´ cÄƒn cá»©.
  ğŸš« TrÃ¡nh
    - KhÃ´ng nÃ³i Ä‘Ã¹a, dÃ¹ng tiáº¿ng lÃ³ng hay biá»ƒu cáº£m thÃ¡i quÃ¡.
    - KhÃ´ng tráº£ lá»i quÃ¡ dÃ i dÃ²ng hoáº·c há»i há»£t.
    - KhÃ´ng phÃ¡n xÃ©t hoáº·c thá»ƒ hiá»‡n cáº£m xÃºc cá»±c Ä‘oan.

end_prompt:
  enable: false
  prompt: |
    HÃ£y má»Ÿ Ä‘áº§u báº±ng cÃ¢u â€œThá»i gian trÃ´i tháº­t nhanhâ€, rá»“i dÃ¹ng nhá»¯ng lá»i chan chá»©a cáº£m xÃºc, lÆ°u luyáº¿n, khÃ´ng ná»¡ rá»i xa Ä‘á»ƒ káº¿t thÃºc cuá»™c trÃ² chuyá»‡n nÃ y nhÃ©!

# ============================================================================
# LOGGING - Cáº¤U HÃŒNH GHI LOG
# ============================================================================

log:
  log_format: "<green>{time:YYMMDD HH:mm:ss}</green>[{version}_{extra[selected_module]}][<light-blue>{extra[tag]}</light-blue>]-<level>{level}</level>-<light-green>{message}</light-green>"
  log_format_file: "{time:YYYY-MM-DD HH:mm:ss} - {version}_{extra[selected_module]} - {name} - {level} - {extra[tag]} - {message}"
  log_level: DEBUG
  log_dir: log
  log_file: "app.log"
  data_dir: data
  selected_module: "00000000000000"

# ============================================================================
# TESTING - Cáº¤U HÃŒNH KIá»‚M THá»¬
# ============================================================================

module_test:
  test_sentences:
    - "ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±"
    - "What's the weather like today?"
    - "è¯·ç”¨100å­—æ¦‚æ‹¬é‡å­è®¡ç®—çš„åŸºæœ¬åŸç†å’Œåº”ç”¨å‰æ™¯"

# ============================================================================
# LLM - LARGE LANGUAGE MODELS (MÃ” HÃŒNH NGÃ”N NGá»®)
# ============================================================================

# ============================================================================
# VAD - VOICE ACTIVITY DETECTION (PHÃT HIá»†N HOáº T Äá»˜NG GIá»ŒNG NÃ“I)
# ============================================================================

VAD:
  SileroVAD:
    type: silero
    # NgÆ°á»¡ng xÃ¡c suáº¥t Ä‘Æ°á»£c coi lÃ  "Ä‘ang nÃ³i". TÄƒng lÃªn (0.55â€“0.65) Ä‘á»ƒ háº¡n cháº¿ cáº¯t sá»›m; giáº£m khi muá»‘n pháº£n há»“i nhanh hÆ¡n.
    threshold: 0.5
    # NgÆ°á»¡ng trá»Ÿ láº¡i tráº¡ng thÃ¡i "im láº·ng". Giá»¯ tháº¥p (0.2â€“0.3) Ä‘á»ƒ trÃ¡nh rá»›t tráº¡ng thÃ¡i Ä‘ang nÃ³i vÃ¬ nhiá»…u.
    threshold_low: 0.25
    # Thá»i gian im láº·ng tá»‘i thiá»ƒu (ms) trÆ°á»›c khi tÃ¡ch cÃ¢u. 700â€“900 cho há»™i thoáº¡i tá»± nhiÃªn, tá»›i 1000 náº¿u váº«n bá»‹ cáº¯t.
    min_silence_duration_ms: 800

# ============================================================================
# INTENT - NHáº¬N THá»¨C Ã Äá»ŠNH
# ============================================================================

Intent:
  nointent:
    type: nointent

  intent_llm:
    type: intent_llm
    llm: ChatGLMLLM
    functions:
      - search_music
      - stop_music
      - stream_music_url

  function_call:
    type: function_call
    functions:
      - get_list_agent
      - create_reminder
      - delete_reminder
      - get_list_reminder
      - update_status_reminder
      - get_economic_calendar
      - change_agent
      - get_news_detail
      - get_news_by_topic
      - search_knowledge_base
      - add_knowledge
      - search_music
      - stop_music
      - stream_music_url
      - play_youtube
      - search_youtube

# ============================================================================
# VOICEPRINT - NHáº¬N Dáº NG GIá»ŒNG NÃ“I
# ============================================================================

# voiceprint:
#   url:
#   speakers:
#     - "test1,å¼ ä¸‰,å¼ ä¸‰æ˜¯ä¸€ä¸ªç¨‹åºå‘˜"
#     - "test2,æå››,æå››æ˜¯ä¸€ä¸ªäº§å“ç»ç†"
#     - "test3,ç‹äº”,ç‹äº”æ˜¯ä¸€ä¸ªè®¾è®¡å¸ˆ"
#   similarity_threshold: 0.4

# ============================================================================
# PLUGINS - CÃC PLUGIN Má» Rá»˜NG
# ============================================================================

plugins:
  # play_music:
  #   music_dir: "" # ä¸ºç©ºåˆ™ä½¿ç”¨é»˜è®¤ä½ç½® (app/music)ï¼Œä¹Ÿå¯è®¾ç½®ç»å¯¹è·¯å¾„
  #   music_ext: # éŸ³ä¹æ–‡ä»¶ç±»å‹ï¼Œp3æ ¼å¼æ•ˆç‡æœ€é«˜
  #     - ".mp3"
  #     - ".wav"
  #     - ".p3"
  #   refresh_time: 300 # åˆ·æ–°éŸ³ä¹åˆ—è¡¨çš„æ—¶é—´é—´éš”ï¼Œå•ä½ä¸ºç§’
  get_economic_calendar:
    - api_timezone: US/Eastern
    - api_url: "https://nfs.faireconomy.media/ff_calendar_thisweek.json"
  news:
    default_source: vnexpress
    max_articles: 10
    timeout: 10
    max_content_length: 4000
    sources:
      vnexpress:
        name: "VnExpress"
        type: rss
        base_url: "https://vnexpress.net/rss"
        topics:
          - name: "Trang chá»§"
            path: "/tin-moi-nhat.rss"
          - name: "Tháº¿ giá»›i"
            path: "/the-gioi.rss"
          - name: "Thá»i sá»±"
            path: "/thoi-su.rss"
          - name: "Kinh doanh"
            path: "/kinh-doanh.rss"
          - name: "Startup"
            path: "/startup.rss"
          - name: "Giáº£i trÃ­"
            path: "/giai-tri.rss"
          - name: "Thá»ƒ thao"
            path: "/the-thao.rss"
          - name: "PhÃ¡p luáº­t"
            path: "/phap-luat.rss"
          - name: "GiÃ¡o dá»¥c"
            path: "/giao-duc.rss"
          - name: "Tin ná»•i báº­t"
            path: "/tin-noi-bat.rss"
          - name: "Sá»©c khá»e"
            path: "/suc-khoe.rss"
          - name: "Äá»i sá»‘ng"
            path: "/gia-dinh.rss"
          - name: "Du lá»‹ch"
            path: "/du-lich.rss"
          - name: "Khoa há»c cÃ´ng nghá»‡"
            path: "/khoa-hoc-cong-nghe.rss"
          - name: "Xe"
            path: "/oto-xe-may.rss"
          - name: "Ã kiáº¿n"
            path: "/y-kien.rss"
          - name: "TÃ¢m sá»±"
            path: "/tam-su.rss"
          - name: "CÆ°á»i"
            path: "/cuoi.rss"

# ============================================================================
# REMINDER SERVICE - Cáº¤U HÃŒNH NHáº®C NHá»
# ============================================================================

reminder:
  scheduler:
    job_store:
      folder: "app/data/reminder_jobs"
      filename: "reminders.sqlite"
  service_key: "reminder-service-primary"
  topic_base: "reminder"
  prompt: |
    Báº¡n lÃ  Lyly, trá»£ lÃ½ nháº¯c nhá»Ÿ thÃ¢n thiá»‡n. Khi nháº­n Ä‘Æ°á»£c thÃ´ng tin lá»i nháº¯c, hÃ£y truyá»n Ä‘áº¡t láº¡i cho ngÆ°á»i dÃ¹ng má»™t cÃ¡ch ngáº¯n gá»n, rÃµ rÃ ng vÃ  áº¥m Ã¡p. Nháº¥n máº¡nh ná»™i dung chÃ­nh cá»§a lá»i nháº¯c, thá»i Ä‘iá»ƒm cáº§n nhá»› vÃ  Ä‘á»™ng viÃªn ngÆ°á»i dÃ¹ng hoÃ n thÃ nh cÃ´ng viá»‡c Ä‘Ãºng lÃºc.
